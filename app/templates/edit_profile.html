{% extends "base.html" %}

{% block content %}
    <div class="form-container">
        <h1>Edit Profile</h1>
        <form action="" method="post" enctype="multipart/form-data" novalidate>
            {{ form.hidden_tag() }}
            <div class="form-group">
                {{ form.username.label }}
                {{ form.username(class="form-control") }}
                {% for error in form.username.errors %}
                <span style="color: red;">[{{ error }}]</span>
                {% endfor %}
            </div>
            <div class="form-group">
                {{ form.bio.label }}
                {{ form.bio(class="form-control", rows=4) }}
                {% for error in form.bio.errors %}
                <span style="color: red;">[{{ error }}]</span>
                {% endfor %}
            </div>
            <div class="form-group">
                {{ form.payment_link.label }}
                {{ form.payment_link(class="form-control") }}
                {% for error in form.payment_link.errors %}
                <span style="color: red;">[{{ error }}]</span>
                {% endfor %}
            </div>
            <div class="form-group">
                {{ form.theme.label }}
                {{ form.theme(class="form-control") }}
                {% for error in form.theme.errors %}
                <span style="color: red;">[{{ error }}]</span>
                {% endfor %}
            </div>
            <div class="form-group">
                {{ form.picture.label }}
                {{ form.picture(class="form-control") }}
                {% for error in form.picture.errors %}
                <span style="color: red;">[{{ error }}]</span>
                {% endfor %}
            </div>
            <div class="form-group">
                {{ form.submit(class="btn") }}
            </div>
        </form>
    </div>

    {% if current_user.active_subscription %}
    <div class="form-container" style="margin-top: 2rem; border-color: #EF4444;">
        <h2>Manage Subscription</h2>
        <p>You are currently subscribed to the <strong>{{ current_user.active_subscription.plan.name }}</strong> plan.</p>
        <p>Your subscription is valid until <strong>{{ current_user.active_subscription.end_date.strftime('%B %d, %Y') }}</strong>.</p>
        <form action="{{ url_for('main.cancel_subscription') }}" method="post">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
            <input type="submit" value="Cancel Subscription" class="btn" style="background-color: #EF4444;" onclick="return confirm('Are you sure you want to cancel your subscription? This will stop all future payments, but your premium access will continue until the end of your current billing period.');">
        </form>
    </div>
    {% endif %}
{% endblock %}